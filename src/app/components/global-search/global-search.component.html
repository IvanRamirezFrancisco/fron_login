<div class="global-search-container">
  <!-- Input de búsqueda -->
  <div class="search-box">
    <span class="material-symbols-outlined search-icon">search</span>
    
    <input
      #searchInput
      type="text"
      class="search-input"
      placeholder="Buscar instrumentos, marcas, categorías..."
      [(ngModel)]="searchQuery"
      (input)="onSearchInput($event)"
      (focus)="openDropdown()"
      (keydown)="onKeyDown($event)"
      autocomplete="off"
    >
    
    <!-- Botón limpiar -->
    <button 
      *ngIf="searchQuery.length > 0"
      class="clear-btn"
      (click)="clearSearch()"
      type="button"
    >
      <span class="material-symbols-outlined">close</span>
    </button>

    <!-- Indicador de carga -->
    <div *ngIf="isSearching" class="loading-indicator">
      <span class="material-symbols-outlined spinning">progress_activity</span>
    </div>
  </div>

  <!-- Dropdown de resultados -->
  <div *ngIf="showDropdown" class="search-dropdown">
    
    <!-- Sugerencias de búsqueda (historial) -->
    <div *ngIf="!hasSearched && searchSuggestions.length > 0" class="suggestions-section">
      <div class="section-header">
        <span class="material-symbols-outlined">history</span>
        <span>Búsquedas recientes</span>
      </div>
      <div class="suggestions-list">
        <button
          *ngFor="let suggestion of searchSuggestions"
          class="suggestion-item"
          (click)="selectSuggestion(suggestion)"
        >
          <span class="material-symbols-outlined">search</span>
          <span>{{ suggestion }}</span>
        </button>
      </div>
    </div>

    <!-- Estado: Cargando -->
    <div *ngIf="isSearching && hasSearched" class="loading-state">
      <span class="material-symbols-outlined spinning">progress_activity</span>
      <p>Buscando productos...</p>
    </div>

    <!-- Estado: Sin resultados -->
    <div *ngIf="!isSearching && hasSearched && noResults" class="no-results-state">
      <span class="material-symbols-outlined">search_off</span>
      <h4>No se encontraron resultados</h4>
      <p>No encontramos productos para "{{ searchQuery }}"</p>
      <div class="suggestions-help">
        <p><strong>Sugerencias:</strong></p>
        <ul>
          <li>Verifica la ortografía</li>
          <li>Intenta con palabras más generales</li>
          <li>Usa sinónimos o términos relacionados</li>
        </ul>
      </div>
    </div>

    <!-- Resultados de búsqueda -->
    <div *ngIf="!isSearching && hasSearched && searchResults.length > 0" class="results-section">
      
      <!-- Header de resultados -->
      <div class="results-header">
        <span class="results-count">
          {{ totalResults }} resultado{{ totalResults !== 1 ? 's' : '' }} encontrado{{ totalResults !== 1 ? 's' : '' }}
        </span>
        <span class="execution-time" *ngIf="executionTime > 0">
          ({{ executionTime }}ms)
        </span>
      </div>

      <!-- Lista de productos -->
      <div class="results-list">
        <div
          *ngFor="let product of searchResults.slice(0, 5)"
          class="result-item"
          (click)="viewProductDetail(product)"
        >
          <!-- Imagen -->
          <div class="result-image">
            <img 
              *ngIf="product.images && product.images.length > 0"
              [src]="product.images[0]" 
              [alt]="product.name"
            >
            <div *ngIf="!product.images || product.images.length === 0" class="image-placeholder">
              <span class="material-symbols-outlined">music_note</span>
            </div>
          </div>

          <!-- Info -->
          <div class="result-info">
            <span class="result-category">{{ product.category.name }}</span>
            <h4 class="result-name" [innerHTML]="highlightMatch(product.name)"></h4>
            <div class="result-meta">
              <span class="result-brand">{{ product.brand }}</span>
              <span *ngIf="product.rating" class="result-rating">
                <span class="material-symbols-outlined">star</span>
                {{ product.rating }}
              </span>
            </div>
          </div>

          <!-- Precio -->
          <div class="result-price">
            <span class="price-current">\${{ product.price | number:'1.2-2' }}</span>
            <span *ngIf="product.discount" class="price-discount">-{{ product.discount }}%</span>
          </div>
        </div>
      </div>

      <!-- Ver todos los resultados -->
      <div class="view-all-footer">
        <button class="btn-view-all" (click)="viewAllResults()">
          Ver todos los resultados ({{ totalResults }})
          <span class="material-symbols-outlined">arrow_forward</span>
        </button>
      </div>
    </div>

  </div>
</div>
