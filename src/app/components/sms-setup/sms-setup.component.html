<div class="sms-setup-container">
  <div class="sms-setup-card">
    
    <!-- Header -->
    <div class="setup-header">
      <h2>
        <i class="fas fa-mobile-alt setup-icon" style="margin-right: 0.5rem;"></i>
        Configurar SMS 2FA
      </h2>
      <p class="setup-subtitle">
        Protege tu cuenta con verificaci√≥n por mensaje de texto
      </p>
    </div>

    <!-- Paso 1: Ingresar n√∫mero de tel√©fono -->
    <div *ngIf="currentStep === 'phone'" class="setup-step">
      <div class="step-indicator">
        <div class="step active">1</div>
        <div class="step-line"></div>
        <div class="step">2</div>
        <div class="step-line"></div>
        <div class="step">3</div>
      </div>
      
      <div class="step-content">
        <h3>Ingresa tu n√∫mero de tel√©fono</h3>
        <p class="step-description">
          Te enviaremos un c√≥digo de verificaci√≥n de 6 d√≠gitos
        </p>

        <form (ngSubmit)="sendVerificationCode()" class="phone-form">
          <div class="form-group">
            <label for="phoneNumber">N√∫mero de tel√©fono</label>
            <div class="input-group">
              <span class="input-icon">üìû</span>
              <input
                type="tel"
                id="phoneNumber"
                [(ngModel)]="phoneNumber"
                name="phoneNumber"
                (input)="onPhoneChange()"
                placeholder="+1234567890"
                class="form-control"
                [class.error]="phoneError"
                maxlength="16"
                required
              >
            </div>
            <div *ngIf="phoneError" class="error-message">
              {{ phoneError }}
            </div>
            <div class="input-help">
              Usa formato internacional (+1 para US/Canad√°, +52 para M√©xico, etc.)
            </div>
          </div>

          <div *ngIf="errorMessage" class="error-message global">
            {{ errorMessage }}
          </div>

          <div class="form-actions">
            <button
              type="button"
              class="btn btn-secondary"
              (click)="cancel()"
              [disabled]="isLoading"
            >
              Cancelar
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="isLoading || !phoneNumber"
            >
              <span *ngIf="isLoading" class="loading-spinner"></span>
              {{ isLoading ? 'Enviando...' : 'Enviar c√≥digo' }}
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Paso 2: Verificar c√≥digo -->
    <div *ngIf="currentStep === 'verification'" class="setup-step">
      <div class="step-indicator">
        <div class="step completed">‚úì</div>
        <div class="step-line completed"></div>
        <div class="step active">2</div>
        <div class="step-line"></div>
        <div class="step">3</div>
      </div>

      <div class="step-content">
        <h3>Verificar c√≥digo</h3>
        <p class="step-description">
          Ingresa el c√≥digo de 6 d√≠gitos enviado a<br>
          <strong>{{ getFormattedPhone() }}</strong>
        </p>

        <div *ngIf="successMessage" class="success-message">
          {{ successMessage }}
        </div>

        <form (ngSubmit)="verifyCode()" class="code-form">
          <div class="form-group">
            <label for="verificationCode">C√≥digo de verificaci√≥n</label>
            <div class="input-group">
              <span class="input-icon">üî¢</span>
              <input
                type="text"
                id="verificationCode"
                [(ngModel)]="verificationCode"
                name="verificationCode"
                (input)="onCodeChange()"
                placeholder="123456"
                class="form-control code-input"
                [class.error]="codeError"
                maxlength="6"
                pattern="[0-9]{6}"
                required
              >
            </div>
            <div *ngIf="codeError" class="error-message">
              {{ codeError }}
            </div>
          </div>

          <div *ngIf="errorMessage" class="error-message global">
            {{ errorMessage }}
          </div>

          <div class="form-actions">
            <button
              type="button"
              class="btn btn-secondary"
              (click)="goBack()"
              [disabled]="isLoading"
            >
              Atr√°s
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="isLoading || !verificationCode"
            >
              <span *ngIf="isLoading" class="loading-spinner"></span>
              {{ isLoading ? 'Verificando...' : 'Verificar c√≥digo' }}
            </button>
          </div>

          <div class="resend-section">
            <p>¬øNo recibiste el c√≥digo?</p>
            <button
              type="button"
              class="btn-link"
              (click)="resendCode()"
              [disabled]="isLoading"
            >
              Reenviar c√≥digo
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Paso 3: √âxito -->
    <div *ngIf="currentStep === 'success'" class="setup-step">
      <div class="step-indicator">
        <div class="step completed">‚úì</div>
        <div class="step-line completed"></div>
        <div class="step completed">‚úì</div>
        <div class="step-line completed"></div>
        <div class="step completed">‚úì</div>
      </div>

      <div class="step-content success-content">
        <div class="success-icon">‚úÖ</div>
        <h3>¬°SMS 2FA Activado!</h3>
        <p class="success-description">
          Tu cuenta ahora est√° protegida con autenticaci√≥n de dos factores por SMS.
        </p>
        
        <div class="success-details">
          <div class="detail-item">
            <i class="fas fa-mobile-alt detail-icon"></i>
            <div class="detail-text">
              <strong>N√∫mero configurado:</strong><br>
              {{ getFormattedPhone() }}
            </div>
          </div>
          <div class="detail-item">
            <i class="fas fa-lock detail-icon"></i>
            <div class="detail-text">
              <strong>Seguridad mejorada:</strong><br>
              Se requerir√° c√≥digo SMS en cada inicio de sesi√≥n
            </div>
          </div>
        </div>

        <div class="form-actions single">
          <button
            type="button"
            class="btn btn-primary"
            (click)="goToDashboard()"
          >
            Ir al Dashboard
          </button>
        </div>
      </div>
    </div>

  </div>
</div>