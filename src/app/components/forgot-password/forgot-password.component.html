<!-- Header -->
<header class="header-main">
  <div class="container">
    <div class="header-content">
      <div class="logo-section" routerLink="/home" style="cursor: pointer;">
        <img src="assets/logoP.png" alt="Casa de Música Castillo" class="logo-image">
        <span class="logo-text">CASTILLO</span>
      </div>
      
      <div class="search-section">
        <div class="search-bar">
          <span class="material-icons">search</span>
          <input type="text" placeholder="Busca guitarras, pianos, y más..." class="search-input">
          <button class="search-btn" type="button">
            <span class="material-icons">arrow_forward</span>
          </button>
        </div>
      </div>
      
      <div class="user-actions">
        <button class="action-btn" title="Lista de deseos">
          <span class="material-icons">favorite_border</span>
        </button>
        <button class="action-btn" routerLink="/login" title="Iniciar sesión">
          <span class="material-icons">person</span>
        </button>
        <button class="action-btn cart-btn" title="Carrito de compras">
          <span class="material-icons">shopping_cart</span>
        </button>
      </div>
    </div>
  </div>
</header>

<!-- Navegación -->
<nav class="secondary-nav">
  <div class="container">
    <ul class="nav-menu">
      <li class="nav-item">
        <a routerLink="/home" class="nav-link">
          <span class="material-icons">home</span>
          Inicio
        </a>
      </li>
      <li class="nav-item">
        <a routerLink="/ofertas" class="nav-link">
          <span class="material-icons">local_offer</span>
          Ofertas
        </a>
      </li>
      <li class="nav-item">
        <a routerLink="/catalogo" class="nav-link">
          <span class="material-icons">inventory_2</span>
          Catálogo
        </a>
      </li>
      <li class="nav-item">
        <a routerLink="/servicios" class="nav-link">
          <span class="material-icons">build</span>
          Servicios
        </a>
      </li>
      <li class="nav-item">
        <a routerLink="/ayuda" class="nav-link">
          <span class="material-icons">help</span>
          Ayuda
        </a>
      </li>
    </ul>
  </div>
</nav>

<!-- Contenido Principal -->
<div class="forgot-password-content">
  <div class="container">
    
    <!-- Mensaje de Éxito -->
    <div *ngIf="message" class="success-card">
      <div class="success-icon">
        <span class="material-icons">check_circle</span>
      </div>
      <h2>¡Correo Enviado!</h2>
      <p class="success-message">{{ message }}</p>
      <p class="info-text">Revisa tu bandeja de entrada y haz clic en el enlace para restablecer tu contraseña</p>
      <button type="button" class="back-btn" (click)="goBack()">
        <span class="material-icons">arrow_back</span>
        Volver al Login
      </button>
    </div>

    <!-- Formulario de Recuperación -->
    <div *ngIf="!message" class="forgot-password-card">
      <div class="forgot-password-header">
        <div class="forgot-password-icon">
          <span class="material-icons">lock_reset</span>
        </div>
        <h1 class="forgot-password-title">Recuperar Contraseña</h1>
        <p class="forgot-password-subtitle">Ingresa tu email y te enviaremos un enlace para restablecer tu contraseña</p>
      </div>

      <div class="forgot-password-body">
        
        <!-- Mensaje de Error -->
        <div *ngIf="error" class="error-alert">
          <span class="material-icons">error</span>
          <span>{{ error }}</span>
        </div>

        <!-- Alerta de Rate Limiting (BLOQUEO) -->
        <div *ngIf="isBlocked" class="blocked-alert">
          <div class="blocked-icon">
            <span class="material-icons">block</span>
          </div>
          <div class="blocked-content">
            <h3>Demasiados Intentos</h3>
            <p>Has excedido el límite de {{ maxAttempts }} intentos de recuperación de contraseña.</p>
            <p>Por tu seguridad, tu acceso ha sido bloqueado temporalmente.</p>
            <div class="blocked-timer">
              <span class="material-icons">schedule</span>
              <strong>Tiempo restante: {{ blockTimeLeft }} minutos</strong>
            </div>
            <div class="blocked-info">
              <span class="material-icons">info</span>
              <span>Intentos realizados: {{ attemptCount }} de {{ maxAttempts }}</span>
            </div>
          </div>
        </div>

        <!-- Información de intentos restantes -->
        <div *ngIf="!isBlocked && attemptCount > 0" class="warning-alert">
          <span class="material-icons">warning</span>
          <div>
            <strong>Advertencia:</strong> Has realizado {{ attemptCount }} de {{ maxAttempts }} intentos.
            <br>
            Te quedan <strong>{{ maxAttempts - attemptCount }} intentos</strong> antes de ser bloqueado temporalmente.
          </div>
        </div>

        <!-- Formulario -->
        <form [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmit()">
          
          <!-- Campo Email -->
          <div class="form-group">
            <label for="email" class="form-label">
              <span class="material-icons">email</span>
              Correo Electrónico
            </label>
            <input
              type="email"
              id="email"
              #emailInput
              formControlName="email"
              [disabled]="isBlocked"
              class="form-input"
              placeholder="tucorreo&#64;ejemplo.com"
              autocomplete="email"
              [class.error]="submitted && f['email'].errors"
              [class.success]="f['email'].valid && f['email'].touched"
              [class.blocked]="isBlocked"
            >
            <div class="error-message" *ngIf="submitted && f['email'].errors">
              <span class="material-icons">cancel</span>
              <span *ngIf="f['email'].errors?.['required']">El email es requerido</span>
              <span *ngIf="f['email'].errors?.['email']">Formato de email inválido</span>
            </div>
            <div class="success-message" *ngIf="f['email'].valid && f['email'].touched">
              <span class="material-icons">check_circle</span>
              <span>Email válido</span>
            </div>
          </div>

          <!-- Botón Submit -->
          <div class="form-actions">
            <button 
              type="submit" 
              class="submit-btn"
              [disabled]="forgotPasswordForm.invalid || loading || isBlocked"
              [class.loading]="loading"
              [class.blocked]="isBlocked"
            >
              <span *ngIf="!loading && !isBlocked" class="btn-content">
                <span class="material-icons">send</span>
                Enviar Enlace de Recuperación
              </span>
              <span *ngIf="loading && !isBlocked" class="btn-content">
                <span class="spinner"></span>
                Enviando...
              </span>
              <span *ngIf="isBlocked" class="btn-content">
                <span class="material-icons">block</span>
                Bloqueado ({{ blockTimeLeft }} min)
              </span>
            </button>
          </div>
        </form>

        <!-- Información de Pasos -->
        <div class="info-box">
          <h3>
            <span class="material-icons">lightbulb</span>
            ¿Qué sucede después?
          </h3>
          <ul class="info-list">
            <li>
              <span class="material-icons">mail</span>
              <span>Recibirás un email en tu bandeja de entrada</span>
            </li>
            <li>
              <span class="material-icons">link</span>
              <span>Haz clic en el enlace del email</span>
            </li>
            <li>
              <span class="material-icons">lock</span>
              <span>Crea una nueva contraseña segura</span>
            </li>
            <li>
              <span class="material-icons">check_circle</span>
              <span>¡Listo! Ya puedes iniciar sesión</span>
            </li>
          </ul>
        </div>

        <!-- Enlaces inferiores -->
        <div class="bottom-links">
          <div class="divider">
            <div class="divider-line"></div>
            <span class="divider-text">o</span>
            <div class="divider-line"></div>
          </div>

          <button type="button" class="link-btn" (click)="goBack()">
            <span class="material-icons">arrow_back</span>
            Volver al Inicio de Sesión
          </button>

          <div class="register-link">
            <p>
              ¿No tienes cuenta?
              <a routerLink="/register">Crear cuenta</a>
            </p>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="footer">
  <div class="container">
    <div class="footer-content">
      <!-- Sección 1: Acerca de -->
      <div class="footer-section">
        <div class="footer-logo">
          <img src="assets/logoP.png" alt="Casa de Música Castillo">
          <span class="footer-logo-text">CASTILLO</span>
        </div>
        <p class="footer-description">
          Tu destino para los mejores instrumentos musicales. Calidad, pasión y excelencia desde 1995.
        </p>
        <div class="social-links">
          <a href="#" class="social-link" title="Facebook">
            <span class="material-icons">facebook</span>
          </a>
          <a href="#" class="social-link" title="Instagram">
            <span class="material-icons">photo_camera</span>
          </a>
          <a href="#" class="social-link" title="Twitter">
            <span class="material-icons">tag</span>
          </a>
          <a href="#" class="social-link" title="YouTube">
            <span class="material-icons">play_circle</span>
          </a>
        </div>
      </div>

      <!-- Sección 2: Enlaces Rápidos -->
      <div class="footer-section">
        <h3>
          <span class="material-icons">menu</span>
          Enlaces Rápidos
        </h3>
        <ul class="footer-links">
          <li>
            <a routerLink="/home">
              <span class="material-icons">home</span>
              Inicio
            </a>
          </li>
          <li>
            <a routerLink="/ofertas">
              <span class="material-icons">local_offer</span>
              Ofertas
            </a>
          </li>
          <li>
            <a routerLink="/catalogo">
              <span class="material-icons">inventory_2</span>
              Catálogo
            </a>
          </li>
          <li>
            <a routerLink="/servicios">
              <span class="material-icons">build</span>
              Servicios
            </a>
          </li>
          <li>
            <a routerLink="/ayuda">
              <span class="material-icons">help</span>
              Ayuda
            </a>
          </li>
        </ul>
      </div>

      <!-- Sección 3: Contacto -->
      <div class="footer-section">
        <h3>
          <span class="material-icons">contact_mail</span>
          Contacto
        </h3>
        <ul class="contact-info">
          <li>
            <span class="material-icons">location_on</span>
            <span>Av. Principal #123, Ciudad de México</span>
          </li>
          <li>
            <span class="material-icons">phone</span>
            <span>+52 55 1234 5678</span>
          </li>
          <li>
            <span class="material-icons">email</span>
            <span>info&#64;castillo.com</span>
          </li>
          <li>
            <span class="material-icons">schedule</span>
            <span>Lun - Sáb: 9:00 AM - 8:00 PM</span>
          </li>
        </ul>
      </div>

      <!-- Sección 4: Newsletter -->
      <div class="footer-section">
        <h3>
          <span class="material-icons">mail</span>
          Newsletter
        </h3>
        <p>Suscríbete para recibir ofertas exclusivas y novedades</p>
        <div class="newsletter-form">
          <input type="email" placeholder="Tu correo electrónico" class="newsletter-input">
          <button class="newsletter-btn">
            <span class="material-icons">send</span>
            Suscribirse
          </button>
        </div>
        <div class="payment-methods">
          <span class="material-icons" title="Visa">credit_card</span>
          <span class="material-icons" title="PayPal">account_balance</span>
          <span class="material-icons" title="Efectivo">payments</span>
        </div>
      </div>
    </div>

    <!-- Footer Bottom -->
    <div class="footer-bottom">
      <div class="footer-bottom-content">
        <p>&copy; 2024 Casa de Música Castillo. Todos los derechos reservados.</p>
        <div class="footer-bottom-links">
          <a href="#">Términos y Condiciones</a>
          <a href="#">Política de Privacidad</a>
          <a href="#">Política de Cookies</a>
        </div>
      </div>
    </div>
  </div>
</footer>
